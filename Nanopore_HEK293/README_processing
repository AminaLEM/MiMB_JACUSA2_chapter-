#Integrate results
#working directory is /prj/JACUSA2_TestField/Nanopore_HEK293/JACUSA2

sort -k5,5gr  WT_vs_KO_RC22_call2_result.out |awk '($13=="A" && $12!~/Y/)' > WT_vs_KO_call2_result.txt
sort -k5,5gr  WT_vs_IVT_RC22_call2_result.out |awk '($13=="A" && $13!~/Y/)' >  WT_vs_IVT_call2_result.txt
sort -k5,5gr  KO_vs_IVT_RC22_call2_result.out |awk '($13=="A" && $13!~/Y/)' >  KO_vs_IVT_call2_result.txt


cut -f 1-6 WT_vs_KO_call2_result.txt WT_vs_IVT_call2_result.txt KO_vs_IVT_call2_result.txt | awk '{print $1"\t"$2"\t"$3"\tCand\t0\t"$6;}' |sort -u > allSites.bed
grep -v pcDNA5 allSites.bed > allSites2.bed
srun bedtools slop -i allSites2.bed -g hg38.genome -b 2 > allSitesExt2.bed

#call2
INP="WT_vs_KO_RC22_call2_result.out WT_vs_IVT_RC22_call2_result.out KO_vs_IVT_RC22_call2_result.out"
srun bedtools intersect -filenames -loj -a allSitesExt2.bed -b ${INP} > call2_SitesExt2.bed

#reformat
cat call2_SitesExt2.bed |perl /prj/JACUSA2_TestField/Nanopore_HEK293/HEK293_data_prep.pl > call2_SitesExt2_indel_slim2.txt

#5mer
srun bedtools getfasta -fi /biodb/genomes/homo_sapiens/GRCh38_96/GRCh38_96.fa -bed allSitesExt2.bed -name -s -tab > checkMotif.txt

#sed -e 's/Cand:://' checkMotif.txt |sed -e 's/\-/_/' |awk '{gsub("[\(\)]","");print $1,$2;}' > checkMotif_reformat.txt

perl -ne 'while(<>){s/Cand:://; 's/\-/_/'; 's/[\(\)]//g'; print;}' checkMotif.txt >  checkMotif_reformat.txt
#ok